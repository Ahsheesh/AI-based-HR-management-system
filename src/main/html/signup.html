<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signup</title>
    <link rel="stylesheet" href="../css/signup.css" />
  </head>
  <body>
    <div class="container">
      <h2 class="createh2">Create an Account</h2>
      <form id="signupForm">
        <input
          type="text"
          name="username"
          placeholder="Create Username"
          required
        />
        <input
          type="password"
          name="password"
          placeholder="Create Password"
          required
        />
        <input
          type="password"
          name="confirmPassword"
          placeholder="Confirm Password"
          required
        />
        <button type="submit">Signup</button>
        <p>Already have an account? <a href="login.html">Login</a></p>
      </form>
    </div>

    <script>
      document
        .getElementById("signupForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const formData = new FormData(e.target);
          const data = Object.fromEntries(formData.entries());

          if (data.password !== data.confirmPassword) {
            alert("Passwords do not match");
            return;
          }

          try {
            const response = await fetch(
              "http://127.0.0.1:5500/signup",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              }
            );

            // First, check if the response is OK (status code 200-299)
            if (response.ok) {
              // Check if the response has a body
              const responseText = await response.text();
              if (responseText) {
                const result = JSON.parse(responseText);
                console.log("Server response:", response.status, result);
                alert(result.message);
                window.location.href = "login.html";
              } else {
                // Handle the case of an empty but successful response
                console.warn("Successful response but with an empty body.");
                alert("Signup successful, but server returned no message.");
                window.location.href = "login.html";
              }
            } else {
              // Handle HTTP errors (e.g., 400, 500)
              const errorText = await response.text();
              console.error("Signup failed:", response.status, errorText);
              try {
                // Attempt to parse the error message as JSON
                const errorResult = JSON.parse(errorText);
                alert(errorResult.message || "Signup failed");
              } catch {
                // If it's not JSON, show the plain text or a generic message
                alert(errorText || "Signup failed. Please try again.");
              }
            }
          } catch (error) {
            console.error("Detailed Signup error:", error);
            alert("An error occurred during signup: " + error.message);
          }
        });
    </script>

    <!-- <script > 
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        // Client-side password validation
        if (data.password !== data.confirmPassword) {
            alert('Passwords do not match');
            return;
        }

        console.log('Sending signup data:', data);

        try {
            // Change this URL to your actual backend API endpoint
            const response = await fetch('http://127.0.0.1:5500/AI-based-HR-management-system/src/main/html/signup.html', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json(); // Attempt to parse JSON response

            if (response.ok) {
                console.log('Server response:', response.status, result);
                alert(result.message);
                window.location.href = 'login.html';
            } else {
                console.error('Signup failed:', response.status, result);
                alert(result.message || 'Signup failed. Please try again.');
            }

        } catch (error) {
            console.error('Detailed Signup error:', error);
            alert('An error occurred during signup: ' + error.message);
        }
    });

    </script> -->
    <!-- <script>

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Client-side password validation
            if (data.password !== data.confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            console.log('Sending signup data:', data); // Log data being sent

            try {
                const response = await fetch('http://127.0.0.1:5500/AI-based-HR-management-system/src/main/html/signup.html', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Server response:', response.status, result);
                } else {
                    const text = await response.text(); // In case it's not JSON
                    console.error('Signup failed:', text);
                }

                // const result = await response.json();
                // console.log('Server response:', response.status, result); // Log full response

                if (response.ok) {
                    alert(result.message);
                    window.location.href = 'login.html';
                } else {
                    alert(result.message || 'Signup failed');
                }
            } catch (error) {
                console.error('Detailed Signup error:', error);
                alert('An error occurred during signup: ' + error.message);
            }
        });
    </script> -->
  </body>
</html>
